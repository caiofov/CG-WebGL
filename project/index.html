<head>
    <title>Trabalho 2 - CG</title>
    <link rel="stylesheet" href="index.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjs/11.8.2/math.js"></script>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
    <script src="game/index.js"></script>


    <script id="vertex-shader" type="notjs">
        // attribute -> muda para cada vértice
        attribute vec4 position;
        attribute vec2 texCoord;
        uniform mat4 transfproj;
        //uniform mat4 transf;

        varying vec2 v_texCoord;

        attribute vec3 normal;
        varying vec3 v_normal;

        uniform vec3 lightpos;
        varying vec3 pointToLight;

        uniform vec3 campos;
        varying vec3 pointToCam;

        void main()
        {   
            gl_Position = transfproj*position; 
            pointToLight = lightpos - position.xyz;
            pointToCam = campos - gl_Position.xyz;

            v_normal = (vec4(normal,1)).xyz;

            v_texCoord = texCoord;
            
        }
    </script>

    <script id="frag-shader" type="notjs">
        precision mediump float;

        //texturas
        uniform sampler2D tex;
        varying vec2 v_texCoord;

        //iluminação:
        varying vec3 v_normal;
        uniform vec3 lightDirection;
        uniform vec3 lightColor;

        //cores sólidas:
        uniform vec4 color;
        uniform bool isSolid;

        varying vec3 pointToLight;
        varying vec3 pointToCam;

        void main()
        {
            vec3 pToLight = normalize(pointToLight);
            vec3 pToCam = normalize(pointToCam);

            vec3 halfVec = normalize(pToCam + pToLight);

            vec3 v_normal_n = normalize(v_normal);
            vec3 lightDirection_n = normalize(-lightDirection);

            float lightd = dot(v_normal_n,lightDirection_n);
            float lightp = dot(v_normal_n,pToLight);
            float lighte = dot(v_normal_n,halfVec);

            if (lightd<0.0) lightd = 0.0;
            if (lightp<0.0) lightp = 0.0;
            if (lighte<0.0) lighte = 0.0;

            if(isSolid){ //Caso verdadeiro, objeto deve ser renderizado com cor sólida
                gl_FragColor = color;
            }else{
                //Com luz de cor
                //gl_FragColor = vec4(lightColor*light*texture2D(tex, v_texCoord).rgb, 1);
                
                // Modelo de reflexão de Phong:
                // Ambiente:
                //gl_FragColor = 0.6 * texture2D(tex, v_texCoord);
                // Direcional:
                //gl_FragColor += 0.5 * lightp * texture2D(tex, v_texCoord);
                

                vec3 texColor = texture2D(tex, v_texCoord).rgb;
                gl_FragColor.rgb = 0.1*lightColor*texColor;
                gl_FragColor.rgb += 0.3*lightColor*lightd*texColor;
                gl_FragColor.rgb += 0.4*lightColor*lightp*texColor;
                gl_FragColor.rgb += 0.4* lightColor*pow(lighte,20.0)*texColor;
                gl_FragColor.a = texture2D(tex, v_texCoord).a;
            }
        }
    </script>
</head>


<body>
    <div class="container mt-10">
        <div class="row">
            <div class="col-6 col-sm-12">
                <section id="#about" >
                    <h2>Sobre o jogo</h2>
                    <p>Inspirado no famoso Subway Surfers, o jogador deverá desviar dos trens para alcançar sua melhor pontuação. Além disso, ele pode também coletar moedas, que adicionarão mais pontos ao seu total.
                    </p>
                    <p>Caso colida com um trem e queira recomeçar, será necessário recarregar a página.
                        </p>
                        <section id="#authors">
                            <h2>Autores</h2>
                            <div>
                                <a href="https://github.com/caiofov">Caio de Freitas Oliveira</a>
                                <a href="https://github.com/matheusriale">Matheus Ribeiro Alencar</a>
                            </div>
                        </section>
                </section>
            </div>

            <div class="col-6 col-sm-12">
                <section id="tech" >
                <h2>Informações técnicas</h2>
                    <ul>
                        <li><b>Câmera:</b> A visão é em 3ª pessoa, podendo ser movida com as teclas WASD. O personagem do jogador também se move junto à câmera.</li>
                        <li><b>Iluminação:</b> Utilizamos o modelo de reflexão de Phong com luzes ambiente, direcional e especular. A luz da moeda é pontual e se move.</li>
                        <li><b>Transformações:</b> Foram realizadas translações para a moeda, jogador e trens. Além disso, a moeda também rotaciona.</li>
                        <li>Todos os objetos tem textura, com exceção do jogador e da moeda, que possuem cor sólida.</li>
                        <li>Utilizamos o <b>WebGL</b> como foi feito durante as aulas da disciplina. Além disso, também utilizamos a biblioteca math.js para realizar operações com matrizes.</li>
                        <li>O jogador e a moeda são objetos carregados de OBJ a partir de um leitor implementador por nós.</li>
                    </ul>
                </section>
        </div>
    </div>
        
        <section id="#game">
            <h2>Jogo</h2>

            
            <div id="#instructions">
                <p>Desvie dos trens! (Utilize as teclas WASD)</p>
                <p>Pontuação atual: <b id="scoreboard">0</b></p>
            </div>
            <div>
                <div class="d-flex flex-column align-items-center">
                    <button id="start-button" class="d-block" onclick="startGame()">Iniciar</button>
                    <div id="game-over" class="d-none text-center">
                        <p class="over-message">GAME OVER</p>
                        <p class="subtitle">(recarregue a página)</p>
                    </div>
                    <canvas id="glcanvas1" class="d-none" width="500" height="500">
                </div>
            </div>
        </section>
    </div>
</body>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz" crossorigin="anonymous"></script>

<script src="game/camera.js"></script>
<script src="game/events.js"></script>
<script src="game/utils.js"></script>
<script src="game/webgl.js"></script>

<script src="game/drawing/readObj.js"></script>
<script src="game/drawing/shapes.js"></script>
<script src="game/drawing/textures.js"></script>
<script src="game/drawing/vertices.js"></script>

<script src="game/elements/game.js"></script>
<script src="game/elements/player.js"></script>
<script src="game/elements/scenario.js"></script>
<script src="game/elements/train.js"></script>
<script src="game/elements/coin.js"></script>

<script>
    function startGame(){
        /**@type {HTMLCanvasElement} */
        let canvas = CANVAS;
        canvas.className = canvas.className.replace("d-none", "d-block")
        
        /**@type {HTMLButtonElement} */
        const startButton = document.querySelector("#start-button")
        startButton.className = startButton.className.replace("d-block", "d-none")
        
        init()
    }
</script>